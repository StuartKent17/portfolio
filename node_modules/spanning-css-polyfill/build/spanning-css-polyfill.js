var e=function(){try{var e=function(){if(!t)return t=!0,Promise.resolve(Promise.resolve(!1)).then(function(e){t=e,window[n].dispatchEvent(new Event("change"))})}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},n="__foldables__",t=!1,i=function(){var t=this;if(void 0!==window[n])return window[n];var i=document.createDocumentFragment();this.addEventListener=i.addEventListener.bind(i),this.removeEventListener=i.removeEventListener.bind(i),this.dispatchEvent=function(e){if("change"===e.type){var n="on"+e.type;return"function"==typeof t[n]&&t[n](e),i.dispatchEvent(e)}},window.addEventListener("message",function(e){"update"===e.data.action&&Object.assign(t,e.data.value)}),window.addEventListener("resize",function(){return function(e,n){var t;return function(){var n=arguments,i=this;clearTimeout(t),t=setTimeout(function(){return e.apply(i,n)},200)}}(e())})},r={spanning:{configurable:!0},foldSize:{configurable:!0},browserShellSize:{configurable:!0}};r.spanning.get=function(){return sessionStorage.getItem(n+"-spanning")||"none"},r.spanning.set=function(t){if(!["none","single-fold-horizontal","single-fold-vertical"].includes(t))throw new TypeError(t);sessionStorage.setItem(n+"-spanning",t),e()},r.foldSize.get=function(){return+sessionStorage.getItem(n+"-fold-size")||0},r.foldSize.set=function(t){if(!(Number(t)>=0))throw new TypeError(t);sessionStorage.setItem(n+"-fold-size",t),e()},r.browserShellSize.get=function(){return+sessionStorage.getItem(n+"-browser-shell-size")||0},r.browserShellSize.set=function(t){if(!(Number(t)>=0))throw new TypeError(t);sessionStorage.setItem(n+"-browser-shell-size",t),e()},i.prototype.getSegments=function(){if("none"===this.spanning)return[{left:0,top:0,width:window.innerWidth,height:window.innerHeight}];if("single-fold-horizontal"===this.spanning){var e=(window.innerHeight-this.browserShellSize)/2,n=window.innerWidth;return[{top:0,left:0,width:n,height:e-this.foldSize/2},{top:e-this.foldSize/2,height:this.foldSize,left:0,width:n},{top:e+this.foldSize/2,left:0,width:n,height:window.innerHeight}]}if("single-fold-vertical"===this.spanning){var t=window.innerWidth/2-this.foldSize/2,i=window.innerHeight;return[{top:0,left:0,width:t,height:i},{top:0,height:i,left:t,width:this.foldSize},{top:0,left:window.innerWidth/2+this.foldSize/2,width:t,height:i}]}},Object.defineProperties(i.prototype,r),window[n]=new i,window.getWindowSegments=function(){var e=window[n].getSegments();return[e[0],e[2]]};var o="spanning",a="single-fold-horizontal",s="single-fold-vertical",l="none",d="(\\s*)(@media.*?\\b"+o+"\\b[^{]+)\\{([\\s\\S]+?\\})(\\s*)\\}",h=/\((.*?)\)/gi,f=/@media[^\(]+/gi,c=function(e){return new RegExp("env\\(\\s*"+e+"\\s*\\)","gi")};function u(e,n){return e.replace(new RegExp(d,"gi"),n)}function g(e){var n=function(e){var n,t=new RegExp(d,"gi");if("function"==typeof e.matchAll)n=Array.from(e.matchAll(t));else{for(n=[];n[n.length]=t.exec(e););n.length--}return n}(e),t={};return t[a]="",t[s]="",t[l]="",n.forEach(function(e){var n=e[1],i=e[2],r=e[3],d=e[4],c=l;i.indexOf(a)>-1&&(c=a),i.indexOf(s)>-1&&(c=s);var u=i.match(f)||[],g=i.match(h)||[];g=g.filter(function(e){return!e.includes(o)}).join(" and "),t[c]+=""+n+u+g+"{"+r+d+"}"}),t}var w=window.matchMedia("(spanning: single-fold-horizontal)").matches||window.matchMedia("(spanning: single-fold-vertical)").matches||window.matchMedia("(spanning: none)").matches||!1;console.info("CSS Spanning Media Queries are supported? "+w);var p,v=new i;if(!w){var m=Array.from(document.querySelectorAll('link[rel="stylesheet"], style'));(p=m,Promise.all(p.map(function(e){return e.href?fetch(e.href).then(function(e){return e.text()}):e.textContent}))).then(function(e){var n=new DocumentFragment;e.forEach(function(e,t){for(var i=u(e,""),r=g(e),o=m[t].href||"inline",a=0,s=Object.entries(r);a<s.length;a+=1){var l=s[a];S[l[0]]+="/* origin: "+o+" */"+l[1]}var d=document.createElement("style");d.setAttribute("data-css-origin",o),d.textContent=i,n.appendChild(d)}),m.forEach(function(e){return null!=e.parentElement&&e.parentElement.removeChild(e)}),document.head.appendChild(n),b()})}var S={"single-fold-horizontal":"","single-fold-vertical":"",none:""};function z(e,n){if(w)return e;var t=u(e,""),i=g(e);n&&(S[n]={"single-fold-horizontal":"","single-fold-vertical":"",none:""});for(var r=n?S[n]:S,o=n?"":"/* origin: inline */",a=0,s=Object.entries(i);a<s.length;a+=1){var l=s[a];r[l[0]]+=""+o+l[1]}return r["non-spanning"]=t,t}function b(e){w||(E(e),v.addEventListener("change",function(){return E(e)}))}function E(e){for(var n,t=v,i=e?S[e.nodeName.toLowerCase()][t.spanning]:S[t.spanning],r=e?S[e.nodeName.toLowerCase()]["non-spanning"]:null,o=v.getSegments(),a=0,s=Object.entries(1===o.length?{}:o[1]);a<s.length;a+=1){var l=s[a];n=l[1]+"px",i=i.replace(c("fold-"+l[0]),n)}var d="__foldables_sheet__",h=function(e,n){for(var t=0,i=e.querySelectorAll("."+d);t<i.length;t+=1)i[t].remove();var r=document.createElement("style");r.className=d,r.textContent=n,e===document?document.head.appendChild(r):e.appendChild(r)};if(e){var f=e.shadowRoot;"adoptedStyleSheets"in f&&f.adoptedStyleSheets.length>0?f.adoptedStyleSheets[0].replace(r+i):h(f,i)}else h(document,i)}export{i as FoldablesFeature,z as adjustCSS,b as observe};
//# sourceMappingURL=spanning-css-polyfill.js.map
